# cursor-memory-cli 项目迭代路线图

> 基于 Codex 深度分析，生成于 2026-02-01

## 项目现状分析

### 定位与核心能力

- **项目定位**：Cursor Memory 系统的安装配置 CLI 工具
- **核心功能**：
  - `setup`：部署 hooks、skills、commands 到全局或项目级别
  - `archive`：手动触发记忆归档，清理过期数据并生成聚合文件

### 代码规模

- **文件数量**：约 24 个文件（排除 assets）
- **代码量**：约 1150 行（.mjs + .sh）
- **技术栈**：Node.js 18+，ESM 模块，零外部依赖

### 架构特点

**优势**
- 纯 Node 内置模块，安装成本低
- hooks 合并具备幂等性
- 归档执行器具备去重、锁机制、隔离区、聚合统计

**潜在问题**
- 缺少测试与验证（无单测/集成测试）
- 配置与兼容性检查不足，错误定位困难
- 可观测性弱，缺少结构化诊断信息
- 记忆查询能力缺失，只有生成/归档，无检索
- 安全性与隐私不足，记忆内容明文存储

---

## 创新功能规划

### P0 - 核心基础设施（必须）

#### 1. Memory Doctor（健康检查）

**解决的痛点**
- 安装或运行失败时难以定位问题
- 用户无法自助诊断配置错误

**技术实现**
- 新增 `doctor` 命令
- 检查项：
  - `hooks.json` 格式合法性
  - hook 脚本权限（可执行）
  - 路径有效性（~/.cursor 或 .cursor）
  - 配置 JSON 语法正确性
  - Node.js 版本兼容性
- 输出修复建议（带颜色的诊断报告）

**预期价值**
- 减少 80% 的配置相关 issues
- 提升用户自助解决问题能力

#### 2. Memory Search（本地检索）

**解决的痛点**
- 记忆无法快速查找和复用
- 只能手动翻阅 JSON 文件

**技术实现**
- 新增 `search` 命令
- 过滤参数：
  - `--since <date>`：时间范围
  - `--type <type>`：记忆类型（decision/insight/pattern 等）
  - `--keyword <word>`：全文关键词搜索
  - `--limit <n>`：结果数量限制
- 输出格式：JSON 或格式化表格

**预期价值**
- 让记忆系统真正可用（从"存储"到"检索"）
- 支持二次开发（API 化）

### P1 - 稳定性与扩展性

#### 3. Schema Validator & Migrator（格式验证与迁移）

**解决的痛点**
- 未来格式升级时兼容性风险高
- 缺少版本管理机制

**技术实现**
- 引入 schema 版本号（在配置文件中）
- 新增 `migrate` 命令
- 检测旧格式并安全迁移到新版本
- 提供回滚机制

**预期价值**
- 平滑升级路径
- 降低破坏性变更风险

#### 4. Smart Retention（智能保留策略）

**解决的痛点**
- 统一 60 天保留不够灵活
- 无法区分重要记忆和临时记忆

**技术实现**
- 根据 `confidence_score` 和 `type` 动态调整保留期
- 高价值记忆（decision/insight）延长至 180 天
- 临时记忆（note）缩短至 30 天
- 聚合时记录"高价值索引"

**预期价值**
- 减少存储浪费
- 保留真正有价值的记忆

### P2 - 增强体验

#### 5. Analytics Dashboard（统计报表）

**解决的痛点**
- 无法了解记忆系统的质量和价值
- 缺少使用数据反馈

**技术实现**
- 生成月度/季度统计报表
- 统计维度：
  - 记忆类型分布
  - 去重率
  - 热门实体/主题
  - 增长趋势
- 输出格式：Markdown 或 JSON

**预期价值**
- 可视化记忆价值
- 帮助优化记忆提取规则

#### 6. Privacy Guard（隐私保护）

**解决的痛点**
- 记忆可能包含敏感信息（API key、密码等）
- 明文存储存在泄露风险

**技术实现**
- 增加可选 `encrypt` 模式
- 使用 Node.js `crypto` 模块加密存储
- 或正则脱敏（PII、凭证等）
- 查询时自动解密

**预期价值**
- 提升安全性
- 符合隐私合规要求

### P3 - 智能化

#### 7. Semantic Dedupe & Recall（语义去重与召回）

**解决的痛点**
- 仅 Jaccard 去重可能漏掉语义重复
- 无法语义相似召回

**技术实现**
- 可选本地 embedding 模块（离线/本地模型）
- 用于更智能的去重
- 支持相似记忆召回

**预期价值**
- 提升去重精度
- 支持"find similar"功能

---

## 迭代路线图

### 短期里程碑（1-2 周）

**目标**：建立核心基础设施

- [ ] Memory Doctor（P0）
  - 实现健康检查逻辑
  - 支持 `doctor` 命令
  - 输出诊断报告
- [ ] Memory Search（P0）
  - 实现基础检索逻辑
  - 支持时间/类型/关键词过滤
  - 输出格式化结果
- [ ] Schema Migrator（P1）
  - 引入版本号机制
  - 实现 `migrate` 命令
  - 提供回滚能力

**交付物**
- 3 个新命令可用
- 基础测试覆盖
- 文档更新

### 中期里程碑（1-2 月）

**目标**：提升稳定性与体验

- [ ] Smart Retention（P1）
  - 扩展保留策略配置
  - 实现动态保留逻辑
  - 聚合统计增强
- [ ] Analytics Dashboard（P2）
  - CLI 报表生成
  - 支持多种统计维度
  - Markdown/JSON 输出

**交付物**
- 智能保留系统上线
- 月度统计报表功能
- 配置文档完善

### 长期里程碑（3-6 月）

**目标**：安全与智能化

- [ ] Privacy Guard（P2）
  - 脱敏规则库
  - 可选加密存储
  - 解密查询支持
- [ ] Semantic Dedupe（P3）
  - 本地语义模型集成
  - 语义去重
  - 相似召回功能

**交付物**
- 隐私保护方案落地
- 智能去重能力提升
- 完整功能测试

---

## 实施建议

### 开发流程

1. **测试先行**
   - 为每个新功能编写单测
   - 集成测试覆盖关键路径
   - CI/CD 自动化测试

2. **文档同步**
   - 每个功能配备使用文档
   - 更新 README 和 CLAUDE.md
   - 提供示例命令

3. **向后兼容**
   - 保持现有命令接口稳定
   - 渐进式引入新功能
   - 提供迁移指南

### 技术债务清理

- [ ] 添加单元测试框架（推荐 Node.js 内置 `node:test`）
- [ ] 结构化日志输出（JSON Lines 格式）
- [ ] 错误处理标准化
- [ ] 代码风格统一（Prettier/ESLint）

### 性能优化

- [ ] 大文件增量解析（避免全量加载）
- [ ] 搜索索引优化（倒排索引）
- [ ] 归档并行处理

### 生态扩展

- [ ] 提供 npm 包发布
- [ ] VSCode 插件集成
- [ ] API Server 模式（HTTP 接口）

---

## 风险与依赖

### 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 零依赖限制 | 功能实现复杂度高 | 评估是否引入轻量依赖（如 minimist） |
| 跨平台兼容性 | Windows 用户可能遇到问题 | 增加 Windows 测试环境 |
| 性能瓶颈 | 大量记忆时搜索慢 | 引入索引机制 |

### 资源依赖

- **开发时间**：1 名开发者，约 3-6 个月全职
- **测试环境**：macOS + Linux + Windows
- **用户反馈**：早期用户试用计划

---

## 成功指标

### 短期（1-2 周）
- [ ] Doctor 命令诊断准确率 > 90%
- [ ] Search 命令响应时间 < 100ms（1000 条记忆）

### 中期（1-2 月）
- [ ] 用户满意度 > 4.5/5
- [ ] 配置错误 issues 减少 80%

### 长期（3-6 月）
- [ ] npm 周下载量 > 500
- [ ] GitHub Stars > 100
- [ ] 社区贡献者 > 5

---

## 附录

### 参考资料

- [Cursor Memory 设计文档](./templates/skills/cursor-memory/SKILL.md)
- [Archive 机制说明](./templates/hooks/cursor-memory-archive.mjs)
- [Memory 类型定义](./templates/skills/cursor-memory/references/TYPES.md)

### 变更历史

| 日期 | 版本 | 变更 |
|-----|------|-----|
| 2026-02-01 | v1.0 | 初始版本，基于 Codex 分析 |
